服务容错（服务熔断，服务降级）服务与服务内处理
    容错性设计不能妥协源于分布式系统的本质是不可靠的，一个服务集群中，程序可能崩溃，宕机，网络可能出现中断。原本分布式架构就是为了提高系统可用性，如果可用性反而下降，那就违背了架构演进的初衷。


    容错策略（面对故障，我们该怎么做）
    前五个是对失败进行弥补
        故障转移：一般部署多个副本，如果调用的服务器出现故障，不会立即返回失败而是自动切换到副本
                 优点：对客户不可见       缺点：需要额外时间及开销      场景：需要幂等
        快速失败：不允许故障转移的场景，对于非幂等的操作，应该快速是出错，尽可能抛出异常
                 优点：对客户有完全控制   缺点：需要处理额外的错误逻辑   场景：不能幂等的操作
        安全失败：有部分服务失败不影响到业务逻辑（审计，日志，调试等）这部分失败也正常返回主业务逻辑
                 优点：不影响主业务       缺点：只适合旁路调用         场景：旁路服务
        沉默失败：如大量请求超时失败，默认不再向他分配请求流量。
                优点：不影响全局业务       缺点：一部分期间该类不可用   场景：频繁超时
        故障恢复：这个一般不单独存在，作为补充错事，把错误信息存入消息队列，系统自动异步重试
                 优点：失败后有机制重试    缺点：会产生堆积           场景：对实时性要求不高

    这两个个是调用前需要考虑的（多重保险）
        并行调用：一开始同时向多个服务调用，其中一个返回成功表示成功
                 优点：尽可能最短时间获取成功    缺点：需要额外资源      场景：资源充足且对失败容忍较低
        广播调用：广播与并行调用像是，只是需要所有请求都成功才算成功
                 优点：需要多个服务同时处理      缺点：资源消耗大        场景：只适合大数据处理
    
    容错设计模式（实现某种容错策略，我们该怎么去做）
        断路器模式
            最基础的模式通过代理（熔断器对象）来一对一的接管服务调用者的远程请求，熔断器会持续监控并统计服务返回的成功失败超时等，当熔断器超过阈值打开，后续访问都会拒绝。（快速失败的策略）
                服务熔断：熔断器做的就是自动服务熔断（下游的中间代理直接返回失败）
                服务降级：不应该只是把异常信息抛到用户界面去，而应该尽力想办法通过其他路径解决问题。(上游系统知道下游系统奔溃不对服务处理，返回默认数据)
                （服务降级是目的，服务降级是方法）
        舱壁隔离模式（服务隔离）
            影响不能影响到整个业务，所以应该把服务建立成多个舱壁，当有一个或两个出问题不会影响到其他
        重试模式
            故障转移及恢复都是对服务进行重复调用，差别在于是同步还是后台异步。重试模式适合解决系统的瞬间故障，重试模式实现并不困难，


流量控制（服务限流）服务入口处理
    系统中资源是有限的，当系统资源不足以支撑外部预期流量时，要建立保护机制。
    限流的方法及模式全部针对整个系统，总有意无意的默认只提供一种业务操作，或每种操作都是等价的，不涉及不同业务请求进入系统集群后，分别调什么服务，每个服务的处理能力的差别。在单体应用上是可行的，在微服务架构上最多只能在集群入口的网关上，对这个那个服务进行集群流量的控制，无法细粒度的管理内部微服务的情况。
    能够控制分布式集群中每个服务消耗的限流算法称为分布式限流

    单机
        单机的指标存储在服务的内存中，
    分布式  
        分布式限流目的就是让各个服务协同限流，无论是限流功能封装为专门的远程服务，亦或是系统采用分布式框架有专门的支持，都需要在每个服务中的内存统计开放出来，让全局限流服务可以访问到


    常见限流机制
        流量计数器：根据当前流量计数结果是否超过阈值，如最大支持80TPS,此时超过就解决超额部分。（绝对时间）
        滑动时间窗：解决流量计数器的缺陷，保证任意时间段内，把数据放到一个时间每个时间窗口，当前只处理当前时间窗口的数据（通过分段的方式）（相对时间）
        漏桶：消息队列的做法。加入了中间的缓冲区域，超过缓冲区域返回失败，在缓冲区域中等待。（固定数量，跟时间没关系）
        令牌桶：发放令牌，能获取到的才能进入系统，(固定数量，银行排队机，能拿到token就代表在限流内)
    分布式限流机制
        1.常见的是放入集中式缓存（redis），以实现集群内的共享，并通过分布式锁，信号量，解决这些数据的读写及访问的并发问题。但每次服务调用会增加一次网络开销，效率不高，限流反而会减低处理能力。
        2.在令牌桶的基础上进行改造，不把令牌看作“通行证”，而是看作数值的形式
        
            1.进入网关领取一定的数值（根据不同的用户角色分放不同的值）
            2.每个服务会消耗一定的值，我们可以把剩余的额度当做内部限流的指标，当剩余值不够是，不允许在访问其他服务（降级）。




